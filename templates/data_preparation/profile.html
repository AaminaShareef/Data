<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile â€” Auralis Insights</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --primary: #477747ff;
  --primary-soft: #e8f5e9;
  --background: #F2EFEA;
  --card-bg: #ffffff;
  --text-dark: #2B2B2B;
  --text-muted: #6A6A6A;
  --shadow: 0 20px 45px rgba(0,0,0,0.08);
  --soft-border: rgba(0,0,0,0.06);
}

/* BASE */
body {
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(180deg, #ECE7E0, var(--background));
  padding: 70px;
  color: var(--text-dark);
}

/* HEADER */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
  padding-bottom: 18px;
  border-bottom: 1px solid var(--soft-border);
}

.header h1 {
  font-family: "Times New Roman", serif;
  color: var(--primary);
  font-size: 28px;
  letter-spacing: 0.3px;
}

.header a {
  text-decoration: none;
  color: var(--primary);
  font-weight: 600;
  font-size: 14px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  opacity: 0.9;
}

.header a:hover {
  opacity: 1;
}

/* PROFILE CARD */
.profile-card {
  background: var(--card-bg);
  padding: 42px;
  border-radius: 28px;
  box-shadow: var(--shadow);
  display: flex;
  gap: 36px;
  margin-bottom: 50px;
  align-items: center;
}

.avatar {
  width: 96px;
  height: 96px;
  border-radius: 50%;
  background: linear-gradient(145deg, #3c583c, #4f6f4f);
  color: white;
  font-size: 38px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.profile-info h2 {
  margin-bottom: 6px;
  font-size: 22px;
}

.profile-info p {
  color: var(--text-muted);
  margin-bottom: 6px;
  font-size: 14px;
}

/* STATS */
.stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 22px;
  margin-bottom: 50px;
}

.stat-card {
  background: var(--card-bg);
  padding: 30px 24px;
  border-radius: 24px;
  box-shadow: var(--shadow);
  text-align: center;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.stat-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 26px 55px rgba(0,0,0,0.12);
}

.stat-card h3 {
  font-size: 30px;
  color: var(--primary);
  margin-bottom: 6px;
}

.stat-card p {
  font-size: 13px;
  color: var(--text-muted);
  letter-spacing: 0.3px;
}

/* MANAGE DATASETS */
.manage-datasets {
  background: var(--card-bg);
  padding: 36px;
  border-radius: 28px;
  box-shadow: var(--shadow);
}

.manage-datasets h3 {
  margin-bottom: 26px;
  font-size: 20px;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 18px 16px;
  border-bottom: 1px solid var(--soft-border);
  text-align: left;
}

th {
  font-size: 13px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.6px;
}

tbody tr {
  transition: background 0.2s ease;
}

tbody tr:hover {
  background: #fafafa;
}

/* ACTIONS */
.dataset-actions {
  display: flex;
  align-items: center;
  gap: 14px;
}

.dataset-actions a,
.link-btn {
  font-size: 13px;
  font-weight: 600;
  color: var(--primary);
  background: none;
  border: none;
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 8px;
  transition: opacity 0.2s ease;
}

.dataset-actions a,
.dataset-actions a:visited,
.dataset-actions a:hover,
.dataset-actions a:active 
.link-btn:hover {
  text-decoration: none;
  text-decoration: none;
}

/* STATUS BADGES */
.badge {
  padding: 6px 14px;
  border-radius: 1000px;
  font-size: 12px;
  font-weight: 600;
}

.badge-processed {
  background: var(--primary-soft);
  color: #2e7d32;
}

.badge-pending {
  background: #fff3e0;
  color: #b26a00;
}

/* TOAST */
#toast-container {
  position: fixed;
  top: 30px;
  right: 30px;
  z-index: 9999;
}

.toast {
  background: var(--primary-soft);
  color: #2e7d32;
  padding: 14px 22px;
  border-radius: 14px;
  font-size: 14px;
  font-weight: 600;
  box-shadow: 0 12px 30px rgba(0,0,0,0.12);
  animation: slideIn 0.4s ease, fadeOut 0.4s ease 2.6s forwards;
}

/* ANIMATIONS */
@keyframes slideIn {
  from { transform: translateX(40px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
  to { opacity: 0; transform: translateX(40px); }
}

/* RESPONSIVE */
@media (max-width: 900px) {
  body { padding: 30px; }
  .stats { grid-template-columns: 1fr; }
  .profile-card { flex-direction: column; text-align: center; }
}

.dataset-table-wrapper {
  max-height: 320px;        /* ~5 rows height */
  overflow-y: auto;
  border-radius: 8px;
}

/* Optional: smooth scrollbar */
.dataset-table-wrapper::-webkit-scrollbar {
  width: 6px;
}

.dataset-table-wrapper::-webkit-scrollbar-thumb {
  background-color: #bbb;
  border-radius: 10px;
}

.dataset-table-wrapper::-webkit-scrollbar-track {
  background: transparent;
}


.no-dataset-state {
  text-align: center;
  padding: 40px 20px;
}

.upload-btn {
  display: inline-block;
  margin-top: 15px;
  padding: 10px 22px;
  background-color: #2e7d32;
  color: #ffffff;
  text-decoration: none;
  border-radius: 25px;
  font-weight: 500;
  transition: background 0.3s ease;
}

.upload-btn:hover {
  background-color: #1b5e20;
}


/* FINAL, CORRECT TABLE ALIGNMENT FIX */
.manage-datasets table {
  table-layout: fixed;
}

.manage-datasets table th:nth-child(1),
.manage-datasets table td:nth-child(1) {
  width: 65%;
}

.manage-datasets table th:nth-child(2),
.manage-datasets table td:nth-child(2) {
  text-align: left;
}

.manage-datasets table th:nth-child(3),
.manage-datasets table td:nth-child(3) {
  width: 20%;
  text-align: center;
}


</style>
</head>

<body>

{% if messages %}
<div id="toast-container">
  {% for message in messages %}
    <div class="toast">{{ message }}</div>
  {% endfor %}
</div>
{% endif %}

<div class="header">
  <h1>User Profile</h1>
  <a href="{% url 'home' %}">
    <i class="fas fa-arrow-left"></i> Back to Home
  </a>
</div>

<!-- PROFILE -->
<div class="profile-card">
  <div class="avatar">
    {{ user.name|slice:":1"|upper }}
  </div>
  <div class="profile-info">
    <h2>{{ user.name }}</h2>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Account Type:</strong> Standard User</p>
  </div>
</div>

<!-- STATS -->
<div class="stats">
  <div class="stat-card">
    <h3>{{ total_datasets }}</h3>
    <p>Total Datasets</p>
  </div>
  <div class="stat-card">
    <h3>{{ processed_datasets }}</h3>
    <p>Processed</p>
  </div>
  <div class="stat-card">
    <h3>{{ pending_datasets }}</h3>
    <p>Pending</p>
  </div>
  <div class="stat-card">
    <h3>{{ total_reports }}</h3>
    <p>Reports Generated</p>
  </div>
</div>

<!-- MANAGE DATASETS -->
<div class="manage-datasets">
  <h3>Manage Datasets</h3>

  {% if recent_datasets %}
<div class="dataset-table-wrapper">

  <table class="dataset-table">
    <thead>
      <tr>
        <th class="col-dataset">Dataset</th>
<th class="col-status">Status</th>
<th class="col-actions">Actions</th>

      </tr>
    </thead>
  </table>

  <div class="dataset-table-body">
    <table class="dataset-table">
      <tbody>
        {% for ds in recent_datasets %}
        <tr>
          <td>{{ ds.file_name }}</td>
          <td>
            {% if ds.is_processed %}
              <span class="badge badge-processed">Processed</span>
            {% else %}
              <span class="badge badge-pending">Pending</span>
            {% endif %}
          </td>
          <td class="dataset-actions">
            <a href="{% url 'dataset_detail' ds.id %}">View</a>

            <form action="{% url 'delete_dataset' ds.id %}"
                  method="post"
                  style="display:inline;"
                  onsubmit="return confirm('Are you sure you want to delete this dataset?');">
              {% csrf_token %}
              <button type="submit" class="link-btn">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% else %}
  <div class="no-dataset-state">
    <p>No datasets available to manage.</p>

    <a href="{% url 'upload_data' %}" class="upload-btn">
      Upload Dataset
    </a>
  </div>
{% endif %}

</div>

</body>
</html>
